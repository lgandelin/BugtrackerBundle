{% extends "WebaccessBugtrackerBundle::layout.html.twig" %}

{% block title %}{{ parent() }}{% endblock %}

{% block description %}{{ parent() }}{% endblock %}

{% block bugtracker_body %}

	{% render "WebaccessBugtrackerBundle:Dashboard:menu" with {'route' : 'dashboard'} %}

	<div id="dashboard" class="main-wrapper">
		<div class="header">
			<div class="title">
				<h1>Tickets</h1>
			</div>
			<div class="button_add">
				<a class="btn btn-warning" href="{{ path('webaccess_bugtracker_ticket_add') }}">add a ticket</a>
			</div>
			<div class="clear"></div>
		</div>

		<table class="table table-striped table-bordered">
			<thead>
				<tr>
					<th>Creation date</th>
					<th>Update date</th>
					<th>Title</th>
					<th>Project</th>
					<th>Author</th>
					<th>Allocated to</th>
					<th>Type</th>
					<th>Status</th>
					<th>Priority</th>
					<th>Action</th>
				</tr>
			</thead>
			<tbody>

			{% if tickets | length > 0 %}
				{% for ticket in tickets %}
			        <tr>
			        	<td>{{ ticket.states[0].createdAt | date('d/m/y H:i') }}</td>
			        	<td>{{ ticket.states[ticket.states | length - 1].createdAt | date('d/m/y H:i') }}</td>
			        	<td>{{ ticket.title }}</td>
			        	<td>{{ ticket.project.name }}</td>
			        	<td>{{ ticket.states[ticket.states | length - 1].authorUser.firstName }} {{ ticket.states[ticket.states | length - 1].authorUser.lastName }}</td>
			        	<td>{{ ticket.states[ticket.states | length - 1].allocatedUser.firstName }} {{ ticket.states[ticket.states | length - 1].allocatedUser.lastName }}</td>
			        	<td>{{ ticket.states[ticket.states | length - 1].type }}</td>
			        	<td>{{ ticket.states[ticket.states | length - 1].status }}</td>
			        	<td>{{ ticket.states[ticket.states | length - 1].priority }}</td>
			        	<td>
							<a class="btn btn-warning" href="{{ path('webaccess_bugtracker_ticket_edit', {'ticket_id':ticket.id}) }}" title="Edit.">Edit.</a>
							<a class="btn btn-warning" href="{{ path('webaccess_bugtracker_ticket_delete', {'ticket_id':ticket.id}) }}" title="Delt.">Delt.</a>
						</td>
			        </tr>
			    {% endfor %}
			{% else %}
				<tr>
					<td colspan="10">No tickets found.</td>
				</tr>
			{% endif %}
			</tbody>
		</table>
	</div>

{% endblock %}

{% block javascripts %}
    {{ parent() }}
{% endblock %}
